openapi: 3.0.0
info:
  title: Procuro API
  version: 1.0.0
  description: API documentation for the AI-powered RFP Management System.

servers:
  - url: http://localhost:5000

paths:

  ############################
  # RFP ROUTES
  ############################

  /rfp:
    post:
      summary: Create an RFP
      tags: [RFP]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RfpInput'
      responses:
        201:
          description: RFP created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Rfp'
        400:
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: List all RFPs
      tags: [RFP]
      responses:
        200:
          description: List of RFPs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Rfp'

  /rfp/{id}:
    get:
      summary: Get an RFP by ID
      tags: [RFP]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        200:
          description: RFP details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Rfp'
        404:
          description: RFP not found

  /rfp/from-text:
    post:
      summary: Generate structured RFP from raw text (AI)
      openapi: 3.0.3
      info:
        title: Procuro API
        version: 1.0.0
        description: REST API for the Procuro single-user procurement assistant.

      servers:
        - url: http://localhost:5000

      paths:
        /rfp:
          post:
            summary: Create an RFP
            tags: [RFP]
            requestBody:
              required: true
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/RfpInput'
            responses:
              '201':
                description: RFP created
                content:
                  application/json:
                    schema:
                      $ref: '#/components/schemas/Rfp'
              '400':
                $ref: '#/components/responses/BadRequest'
          get:
            summary: List all RFPs
            tags: [RFP]
            responses:
              '200':
                description: List of RFPs
                content:
                  application/json:
                    schema:
                      type: array
                      items:
                        $ref: '#/components/schemas/Rfp'
              '400':
                $ref: '#/components/responses/BadRequest'

        /rfp/from-text:
          post:
            summary: Generate structured RFP from raw text using Groq
            tags: [RFP]
            requestBody:
              required: true
              content:
                application/json:
                  schema:
                    type: object
                    required: [text]
                    properties:
                      text:
                        type: string
                        description: Natural language procurement request
            responses:
              '200':
                description: Structured RFP JSON
                content:
                  application/json:
                    schema:
                      $ref: '#/components/schemas/StructuredRfp'
              '400':
                $ref: '#/components/responses/BadRequest'

        /rfp/{id}:
          get:
            summary: Get an RFP by ID
            tags: [RFP]
            parameters:
              - $ref: '#/components/parameters/RfpId'
            responses:
              '200':
                description: RFP details
                content:
                  application/json:
                    schema:
                      $ref: '#/components/schemas/Rfp'
              '400':
                $ref: '#/components/responses/BadRequest'
              '404':
                $ref: '#/components/responses/NotFound'

        /rfp/{id}/compare:
          get:
            summary: Compare proposals for an RFP using Groq
            tags: [RFP]
            parameters:
              - $ref: '#/components/parameters/RfpId'
            responses:
              '200':
                description: AI-generated comparison
                content:
                  application/json:
                    schema:
                      $ref: '#/components/schemas/CompareResponse'
              '400':
                $ref: '#/components/responses/BadRequest'
              '404':
                $ref: '#/components/responses/NotFound'

        /vendors:
          post:
            summary: Create a vendor
            tags: [Vendors]
            requestBody:
              required: true
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/VendorInput'
            responses:
              '201':
                description: Vendor created
                content:
                  application/json:
                    schema:
                      $ref: '#/components/schemas/Vendor'
              '400':
                $ref: '#/components/responses/BadRequest'
          get:
            summary: List all vendors
            tags: [Vendors]
            responses:
              '200':
                description: Vendor list
                content:
                  application/json:
                    schema:
                      type: array
                      items:
                        $ref: '#/components/schemas/Vendor'
              '400':
                $ref: '#/components/responses/BadRequest'

        /proposals:
          post:
            summary: Create a proposal
            tags: [Proposals]
            requestBody:
              required: true
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/ProposalInput'
            responses:
              '201':
                description: Proposal created
                content:
                  application/json:
                    schema:
                      $ref: '#/components/schemas/Proposal'
              '400':
                $ref: '#/components/responses/BadRequest'

        /proposals/{id}:
          get:
            summary: Get proposal by ID
            tags: [Proposals]
            parameters:
              - name: id
                in: path
                required: true
                schema:
                  type: integer
            responses:
              '200':
                description: Proposal details
                content:
                  application/json:
                    schema:
                      $ref: '#/components/schemas/Proposal'
              '400':
                $ref: '#/components/responses/BadRequest'
              '404':
                $ref: '#/components/responses/NotFound'

        /proposals/rfp/{rfpId}:
          get:
            summary: List proposals for an RFP
            tags: [Proposals]
            parameters:
              - $ref: '#/components/parameters/RfpId'
            responses:
              '200':
                description: Proposal list
                content:
                  application/json:
                    schema:
                      type: array
                      items:
                        $ref: '#/components/schemas/Proposal'
              '400':
                $ref: '#/components/responses/BadRequest'

        /email/send:
          post:
            summary: Send an RFP to selected vendors via email
            tags: [Email]
            requestBody:
              required: true
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/EmailSendRequest'
            responses:
              '200':
                description: Email dispatch result
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        success:
                          type: boolean
                        sentTo:
                          type: integer
              '400':
                $ref: '#/components/responses/BadRequest'

      components:
        parameters:
          RfpId:
            name: id
            in: path
            required: true
            schema:
              type: integer

        responses:
          BadRequest:
            description: Invalid request
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
          NotFound:
            description: Resource not found
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'

        schemas:
          ErrorResponse:
            type: object
            properties:
              error:
                type: string

          RfpInput:
            type: object
            required: [title, items]
            properties:
              title:
                type: string
              description_raw:
                type: string
              description_structured:
                type: object
              items:
                type: array
                items:
                  type: string
              budget:
                type: number
                nullable: true
              delivery_timeline:
                type: string
                nullable: true
              payment_terms:
                type: string
                nullable: true
              warranty:
                type: string
                nullable: true

          StructuredRfp:
            type: object
            properties:
              title:
                type: string
              budget:
                type: string
              items:
                type: array
                items:
                  type: string
              delivery_timeline:
                type: string
              payment_terms:
                type: string
              warranty:
                type: string

          Rfp:
            allOf:
              - $ref: '#/components/schemas/RfpInput'
              - type: object
                properties:
                  id:
                    type: integer
                  description_structured:
                    type: object
                    nullable: true
                  items:
                    type: array
                    items:
                      type: string
                  created_at:
                    type: string
                    format: date-time

          VendorInput:
            type: object
            required: [name, email]
            properties:
              name:
                type: string
              email:
                type: string
                format: email

          Vendor:
            allOf:
              - $ref: '#/components/schemas/VendorInput'
              - type: object
                properties:
                  id:
                    type: integer

          ProposalInput:
            type: object
            required: [rfp_id, vendor_id]
            properties:
              rfp_id:
                type: integer
              vendor_id:
                type: integer
              raw_email:
                type: string
                nullable: true
              parsed:
                type: object
                nullable: true

          Proposal:
            allOf:
              - $ref: '#/components/schemas/ProposalInput'
              - type: object
                properties:
                  id:
                    type: integer
                  created_at:
                    type: string
                    format: date-time
                  vendor_name:
                    type: string
                    nullable: true
                  vendor_email:
                    type: string
                    nullable: true

          CompareResponse:
            type: object
            properties:
              ranking:
                type: array
                items:
                  type: string
              scores:
                type: object
                additionalProperties:
                  type: number
              recommendation:
                type: string

          EmailSendRequest:
            type: object
            required: [rfpId, vendorIds]
            properties:
              rfpId:
                type: integer
              vendorIds:
                type: array
                items:
                  type: integer
      tags: [Proposal]
      parameters:
        - in: path
          name: rfpId
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Proposal list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Proposal'

  /proposals/parse:
    post:
      summary: Parse vendor email proposal (AI)
      tags: [Proposal, AI]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                rawEmailText:
                  type: string
      responses:
        200:
          description: Parsed vendor proposal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParsedProposal'


  ############################
  # EMAIL ROUTES
  ############################

  /email/send:
    post:
      summary: Send RFP to selected vendors via email
      tags: [Email]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmailSendRequest'
      responses:
        200:
          description: Email sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailSendResponse'


###############################################
# COMPONENT SCHEMAS
###############################################

components:
  schemas:

    ############################
    # RFP SCHEMAS
    ############################

    RfpInput:
      type: object
      required: [title, budget, items]
      properties:
        title:
          type: string
        budget:
          type: string
        items:
          type: array
          items:
            type: string
        delivery_timeline:
          type: string
        payment_terms:
          type: string
        warranty:
          type: string

    Rfp:
      allOf:
        - $ref: '#/components/schemas/RfpInput'
        - type: object
          properties:
            id:
              type: integer

    StructuredRfp:
      type: object
      properties:
        title:
          type: string
        budget:
          type: string
        items:
          type: array
          items:
            type: string
        delivery_timeline:
          type: string
        payment_terms:
          type: string
        warranty:
          type: string


    ############################
    # VENDOR SCHEMAS
    ############################

    VendorInput:
      type: object
      required: [name, email]
      properties:
        name:
          type: string
        email:
          type: string

    Vendor:
      allOf:
        - $ref: '#/components/schemas/VendorInput'
        - type: object
          properties:
            id:
              type: integer


    ############################
    # PROPOSAL SCHEMAS
    ############################

    ProposalInput:
      type: object
      required: [rfp_id, vendor_id]
      properties:
        rfp_id:
          type: integer
        vendor_id:
          type: integer
        item_prices:
          type: array
          items:
            type: object
            properties:
              item:
                type: string
              price:
                type: number
        total_cost:
          type: number
        delivery_time:
          type: string
        terms:
          type: string
        conditions:
          type: string

    Proposal:
      allOf:
        - $ref: '#/components/schemas/ProposalInput'
        - type: object
          properties:
            id:
              type: integer


    ParsedProposal:
      type: object
      properties:
        item_prices:
          type: array
          items:
            type: object
            properties:
              item:
                type: string
              price:
                type: number
        total_cost:
          type: number
        delivery_time:
          type: string
        terms:
          type: string
        conditions:
          type: string


    ComparisonResult:
      type: object
      properties:
        ranking:
          type: array
          items:
            type: string
        scores:
          type: object
          additionalProperties:
            type: number
        recommendation:
          type: string


    ############################
    # EMAIL SCHEMAS
    ############################

    EmailSendRequest:
      type: object
      properties:
        rfp_id:
          type: integer
        vendor_ids:
          type: array
          items:
            type: integer

    EmailSendResponse:
      type: object
      properties:
        message:
          type: string

    ############################
    # ERROR SCHEMA
    ############################

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
